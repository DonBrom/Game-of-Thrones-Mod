namespace = food

# Setup
country_event = {
	id = food.100
	title = food.100.title
	desc = food.100.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes
	hidden = yes
    
    trigger = {
        NOT = { has_country_flag = set_food }
    }

    immediate = {
        set_country_flag = set_food
        
        set_variable = {
            which = food_count
            value = 1000
        }
        # Disable food system
        #set_global_flag = food_system_active
    }
    
	option = {
		name = food.1.option.a
		
	}
}

# Harvest
province_event = {
	id = food.2
	title = food.2.title
	desc = food.2.desc
	picture = FEAST_eventPicture
	
	hidden = yes
	
	trigger = {
        has_global_flag = food_system_active
        is_month = 7
        NOT = { is_month = 10 }
        NOT = { has_province_modifier = harvest_done }
        OR = {
            trade_goods = grain
            trade_goods = fish
            trade_goods = wine
            trade_goods = tea
            trade_goods = spices
            trade_goods = coffee
            trade_goods = sugar
            trade_goods = cocoa
            trade_goods = fruit
        }
	}
    
    immediate = {
        add_province_modifier = {
            name = harvest_done
            duration = 90
            hidden = yes
        }
        
        export_to_variable = {
            which = food_count
            value = modifier:trade_goods_size
        }

        multiply_variable = { which = food_count value = 1000 }
        divide_variable = { which = food_count value = 100 }
        
        multiply_variable = { which = food_count value = 2 }
        
        # Modifiers
        # Event
        if = {
            limit = { 
                owner = { has_country_modifier = glorious_harvest }
            }
            multiply_variable = { which = food_count value = 2 }
        }
        # Is Capital
        if = {
            limit = { 
                is_capital = yes
            }
            multiply_variable = { which = food_count value = 1.5 }
        }
        # Is Sieged
        if = {
            limit = { 
                has_siege = yes
            }
            set_variable = { which = food_count value = 0 }
        }
        # Is Occupied
        if = {
            limit = { 
                NOT = { owned_by = owner }
            }
            set_variable = { which = food_count value = 0 }
        }
        
        # Climate
        if = {
            limit = { 
                has_climate = tropical
            }
            multiply_variable = { which = food_count value = 0.75 }
        }
        if = {
            limit = { 
                has_climate = arid
            }
            multiply_variable = { which = food_count value = 0.5 }
        }
        if = {
            limit = { 
                has_climate = arctic
            }
            multiply_variable = { which = food_count value = 0.1 }
        }
        
        # AI Bonus
        if = {
            limit = { 
                owner = {
                    ai = yes
                }
            }
            multiply_variable = { which = food_count value = 2 }
        }
        
        owner = {
            change_variable = { 
                which = food_count
                which = FROM
            }
        }
    }
	
    mean_time_to_happen = {
		days = 1
    }
    
	option = {
		name = food.2.option.a
		
	}
}

# Consumption
country_event = {
	id = food.3
	title = food.3.title
	desc = food.3.desc
	picture = FEAST_eventPicture
	
	hidden = yes
    
    trigger = {
        has_global_flag = food_system_active
        NOT = { has_country_modifier = consumption_done }
        OR = {
            AND = {
                is_month = 0
                NOT = { is_month = 1 }
            }
            AND = {
                is_month = 3
                NOT = { is_month = 4 }
            }
            AND = {
                is_month = 6
                NOT = { is_month = 7 }
            }
            AND = {
                is_month = 9
                NOT = { is_month = 10 }
            }
        }
    }
    
    mean_time_to_happen = {
		days = 1
    }
    
    immediate = {
        add_country_modifier = {
            name = consumption_done
            duration = 30
            hidden = yes
        }
        
        # Development
        export_to_variable = {
            which = total_dev_count
            value = states_development
        }
        
        divide_variable = { which = total_dev_count value = 10 }
        
        # Army
        export_to_variable = {
            which = army_size_count
            value = army_size
        }
        
        # Navy
        export_to_variable = {
            which = navy_size_count
            value = navy_size
        }
        
        if = {
            limit = {
                is_at_war = yes
            }
            
            multiply_variable = { which = army_size_count value = 2 }
            multiply_variable = { which = navy_size_count value = 2 }
        }
        
        set_variable = { which = dbg_total_dev_count which = total_dev_count }
        set_variable = { which = dbg_army_size_count which = army_size_count }
        set_variable = { which = dbg_navy_size_count which = navy_size_count }
        
        
        subtract_variable = { which = food_count which = total_dev_count }
        subtract_variable = { which = food_count which = army_size_count }
        subtract_variable = { which = food_count which = navy_size_count }
    }
    
	option = {
		name = food.3.option.a
		
	}
}

# Silo Burnt!
# Reports have come in that tell us of a grain silo burning down in one of our villages. This will greatly impact our food supply unless make up for the loss by importing more from abroad.
# Suffer the loss
# Import to cover the loss
country_event = {
	id = food.4
	title = food.4.title
	desc = food.4.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes

    trigger = {
        has_global_flag = food_system_active
        check_variable = {
            which = food_count
            value = 0
        }
    }
    
	option = {
		name = food.4.option.a
		
        subtract_variable = {
            which = food_count
            value = 250
        }
	}
    
    option = {
		name = food.4.option.b
		
        add_dip_power = -100
	}
}

# Rat Infestation
# Reports have come in that tell us of a grain silo has been infested with virmin. As a result, all the grain contained within is inedible. This will greatly impact our food supply unless make up for the loss by importing more from abroad.
# Suffer the loss
# Import to cover the loss
country_event = {
	id = food.5
	title = food.5.title
	desc = food.5.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes

    trigger = { 
        has_global_flag = food_system_active
        check_variable = {
            which = food_count
            value = 0
        }
    }
    
	option = {
		name = food.5.option.a
		
        subtract_variable = {
            which = food_count
            value = 100
        }
	}
    
    option = {
		name = food.5.option.b
		
        add_dip_power = -100
	}
}

# Greedy Nobles
# The local nobles have taken control of the grain stores in their region. They demand payment, otherwise they threaten to keep the grain for themselves.
# Bribe the nobles
# Make them pay!
# Suffer the loss
country_event = {
	id = food.6
	title = food.6.title
	desc = food.6.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes

    trigger = {
        has_global_flag = food_system_active
        check_variable = {
            which = food_count
            value = 0
        }
    }
    
    option = {
		name = food.6.option.a
		
        add_years_of_income = -0.5
	}
    
    option = {
		name = food.6.option.b
		
        random_owned_province = {
            noble_rebels = 1
        }
	}
    
	option = {
		name = food.6.option.c
		
        subtract_variable = {
            which = food_count
            value = 150
        }
	}
}

# Glorious Harvest
# Farmers are telling us of a glorious harvest, with unprecedented crop sizes. This will be a grand summer indeed.
country_event = {
	id = food.7
	title = food.7.title
	desc = food.7.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes

    trigger = {
        has_global_flag = food_system_active
        NOT = { has_country_modifier = glorious_harvest }
    }
    
	option = {
		name = food.7.option.a
		
        hidden_effect = {
            add_country_modifier = {
                name = glorious_harvest
                duration = 365
            }
        }
        
        custom_tooltip = food_harvest_doubled_tt
	}
}

# Poor Harvest
# Farmers are telling us of a poor harvest, with small crop sizes. This will be a tough summer indeed.
country_event = {
	id = food.8
	title = food.8.title
	desc = food.8.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes

    trigger = {
        has_global_flag = food_system_active
        NOT = { has_country_modifier = poor_harvest }
    }
    
	option = {
		name = food.8.option.a
		
        hidden_effect = {
            add_country_modifier = {
                name = poor_harvest
                duration = 365
            }
        }
        
        custom_tooltip = food_harvest_halved_tt
	}
}