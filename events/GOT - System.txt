namespace = GOT_SYSTEM

country_event = {
	id = GOT_SYSTEM.1
	title = GOT_SYSTEM.1.title
	desc = GOT_SYSTEM.1.desc
	picture = SPY_eventPicture
	
	is_triggered_only = yes
	hidden = yes
    
    trigger = {
        NOT = { has_global_flag = completed_global_setup }
    }
	
    immediate = {
        set_global_flag = completed_global_setup
    }
    
	option = {
		name = GOT_SYSTEM.1.option.a
		
        # set_global_flag = enable_onaction_logging
        #set_global_flag = enable_event_logging
        
        if = { limit = { has_global_flag = enable_event_logging } log = "[Root.GetName] - GOT_SYSTEM.1.option.a" }
        
        # Set processor
        random_country = {
            limit = { ai = yes }
            set_country_flag = processor
        }
     
        every_province = {
            set_in_empire = no
        }
		
        # Bookmark flags
        if = {
			limit = {
				NOT = { is_year = 106 }
			}
			set_global_flag = shattered_world
		}
	}
}

country_event = {
	id = GOT_SYSTEM.2
	title = GOT_SYSTEM.2.title
	desc = GOT_SYSTEM.2.desc
	picture = SPY_eventPicture
	
	is_triggered_only = yes
	hidden = yes
    
    trigger = {
        NOT = { has_country_flag = completed_country_setup }
    }
	
    immediate = {
        country_event = { id = GOT_SYSTEM.3 }
        country_event = { id = GOT_SYSTEM.4 }
        
        add_opinion = {
            who = WIT
            modifier = white_walkers
        }
        WIT = {
            add_opinion = {
                who = ROOT
                modifier = white_walkers
            }
        }
        
		if = {
			limit = {
				primary_culture = free_folk
			}
			
			every_country = {
				limit = {
					is_westeros_culture = yes
				}
				add_opinion = {
					who = ROOT
					modifier = westeros_hates_wildlings
				}
			}
			
		}
		
		if = {
			limit = {
				tag = Z01
			}
			#set_primitive = no
			every_owned_province = {
				limit = {
					has_climate = arctic
				}
				
				add_permanent_province_modifier = {
					name = wildling_arctic_homeland
					duration = -1
				}
			}
		}
		
        set_country_flag = completed_country_setup
    }
    
	option = {
		name = GOT_SYSTEM.2.option.a

        if = { limit = { has_global_flag = enable_event_logging } log = "[Root.GetName] - GOT_SYSTEM.2.option.a" }
	}
}

# Setup Slavery Stance
country_event = {
	id = GOT_SYSTEM.3
	title = GOT_SYSTEM.3.title
	desc = GOT_SYSTEM.3.desc
	picture = FEAST_eventPicture
	
	is_triggered_only = yes
	hidden = yes
    
    immediate = {   
        if = {
            limit = {
				NOT = { tag = U25 }
                capital_scope = {
                    NOT = { continent = westeros }
                }
            }
            add_country_modifier = {
                name = slavery_permitted
                duration = -1
                hidden = yes
            }
        }
        if = {
            limit = {
				OR = {
					tag = U25
					capital_scope = {
						continent = westeros
					}
				}
            }
            add_country_modifier = {
                name = slavery_prohibited
                duration = -1
                hidden = yes
            }
        }
    }
    
	option = {
		name = GOT_SYSTEM.3.option.a
	}
}

country_event = {
	id = GOT_SYSTEM.4
	title = GOT_SYSTEM.4.title
	desc = GOT_SYSTEM.4.desc
	picture = ASSASSINATION_eventPicture
	
    hidden = yes
    is_triggered_only = yes
    
	option = {
		name = GOT_SYSTEM.4.option.a
		  
		# Westeros
        if = {
            limit = {
                capital_scope = {
                    superregion = westeros_superregion
                }
            }
            westeros_superregion = {
                discover_country = ROOT
            }
			westeros_sea_region = {
                discover_country = ROOT
            }
			west_essos_superregion = {
                discover_country = ROOT
            }
			westeros_wastelands = {
                discover_country = ROOT
            }
			essos_west_wastelands = {
                discover_country = ROOT
            }
			shivering_sea_region = {
				undiscover_country = ROOT
			}
            # Lakes
            884 = {
                discover_country = ROOT
            }
            885 = {
                discover_country = ROOT
            }      
            882 = {
                discover_country = ROOT
            }        
            883 = {
                discover_country = ROOT
            }        
            881 = {
               discover_country = ROOT
            }          
            880 = {
                discover_country = ROOT
            }
        }

		# Free Cities
        if = {
            limit = {
                capital_scope = {
                    superregion = west_essos_superregion
                }
            }
			westeros_superregion = {
                discover_country = ROOT
            }
			westeros_sea_region = {
                discover_country = ROOT
            }
			west_essos_superregion = {
                discover_country = ROOT
            }
			westeros_wastelands = {
                discover_country = ROOT
            }
			essos_west_wastelands = {
                discover_country = ROOT
            }
            central_essos_superregion = {
                discover_country = ROOT
            }
			ghiscari_sea_region = {
                discover_country = ROOT
            }
			region_slavers_bay = {
                discover_country = ROOT
            }
			region_valyria = {
                discover_country = ROOT
            }
			region_sarnor = {
                discover_country = ROOT
            }
			omber_sea_region = {
                discover_country = ROOT
            }
			shivering_sea_region = {
				undiscover_country = ROOT
			}
            # Lakes
            3005 = {
                discover_country = ROOT
            }
            3006 = {
                discover_country = ROOT
            }
            3007 = {
                discover_country = ROOT
            }
            1076 = {
                discover_country = ROOT
            }
        } 

		# Central Essos
        if = {
            limit = {
                OR = {
                    technology_group = dothraki
                    capital_scope = {
                        superregion = central_essos_superregion
                    }
                }
            }
			
            west_essos_superregion = {
                discover_country = ROOT
            }
			central_essos_superregion = {
                discover_country = ROOT
            }
			essos_central_wastelands = {
                discover_country = ROOT
            }
			essos_east_wastelands = {
                discover_country = ROOT
            }
			far_essos_superregion = {
                discover_country = ROOT
            }
			region_thousand_islands = {
                undiscover_country = ROOT
            }
			nefer_sea_region = {
                undiscover_country = ROOT
            }
			region_cannibal_sands = {
                undiscover_country = ROOT
            }
			region_mossovy = {
                undiscover_country = ROOT
            }
			region_shadowlands = {
                undiscover_country = ROOT
            }
			region_bloodlands = {
                undiscover_country = ROOT
            }
			east_sothoryos_sea_area = {
                discover_country = ROOT
            }
            # Lakes
            3005 = {
                discover_country = ROOT
            }
            3006 = {
                discover_country = ROOT
            }
            3007 = {
                discover_country = ROOT
            }
            1076 = {
                discover_country = ROOT
            }
            3008 = {
                discover_country = ROOT
            }
            3009 = {
                discover_country = ROOT
            }
            1077 = {
                discover_country = ROOT
            }
            1078 = {
                discover_country = ROOT
            }
            1129 = {
                discover_country = ROOT
            }
		}
		
		# Far Essos
        if = {
            limit = {
                capital_scope = {
                    superregion = far_essos_superregion
                }
            }
            far_essos_superregion = {
                discover_country = ROOT
            }
			region_qarth = {
                discover_country = ROOT
            }
			region_slavers_bay = {
                discover_country = ROOT
            }
			ghiscari_sea_region = {
                discover_country = ROOT
            }
			essos_east_wastelands = {
                discover_country = ROOT
            }
			essos_central_wastelands = {
                discover_country = ROOT
            }
			east_sothoryos_sea_area = {
                discover_country = ROOT
            }
            1129 = {
                discover_country = ROOT
            }
            1128 = {
                discover_country = ROOT
            }
            1127 = {
                discover_country = ROOT
            }
            
        } 

		# Asshai and the Mythicals
		if = {
            limit = {
                capital_scope = {
                    OR = {
                        region = region_shadowlands
                        region = region_bloodlands
                        region = region_mossovy
                        region = region_thousand_islands
                        region = region_dry_bones
                        region = region_carcosa
                        region = region_cannibal_sands
                    }
                }
            }
            far_essos_superregion = {
                discover_country = ROOT
            }
			region_qarth = {
                discover_country = ROOT
            }
			region_slavers_bay = {
                discover_country = ROOT
            }
			ghiscari_sea_region = {
                discover_country = ROOT
            }
			essos_east_wastelands = {
                discover_country = ROOT
            }
			essos_central_wastelands = {
                discover_country = ROOT
            }
			region_gemstone_islands = {
                discover_country = ROOT
            }
			region_ulthos = {
                discover_country = ROOT
            }
			ulthos_sea_region = {
                discover_country = ROOT
            }
			ulthos_wastelands = {
                discover_country = ROOT
            }
			east_sothoryos_sea_area = {
                discover_country = ROOT
            }
            bloodless_coast_area = {
                discover_country = ROOT
            }
            1129 = {
                discover_country = ROOT
            }
            1128 = {
                discover_country = ROOT
            }
            1127 = {
                discover_country = ROOT
            }
            1600 = {
                discover_country = ROOT
            }
            1443 = {
                discover_country = ROOT
            }
            1113 = {
                discover_country = ROOT
            }
            1112 = {
                discover_country = ROOT
            }
            1098 = {
                discover_country = ROOT
            }
        } 
		
		# Summer Islands and Stepstones
        if = {
            limit = {
                capital_scope = {
                    OR = {
                        region = region_summer_islands
                        region = region_stepstones
                    }
                }
            }
            region_summer_islands = {
                discover_country = ROOT
            }
			summer_islands_sea_region = {
                discover_country = ROOT
            }
			westeros_sea_region = {
                discover_country = ROOT
            }
			westeros_superregion = {
                discover_country = ROOT
            }
			shivering_sea_region = {
                undiscover_country = ROOT
            }
			west_essos_superregion = {
                discover_country = ROOT
            }
			north_essosian_coast_area = {
                undiscover_country = ROOT
            }
			westeros_wastelands = {
                discover_country = ROOT
            }
			essos_west_wastelands = {
                discover_country = ROOT
            }
			west_sothoryos_sea_area = {
                discover_country = ROOT
            }
        } 
        
        if = {
            limit = {
                capital_scope = {
                    region = region_ibben
                }
            }
            central_essos_superregion = {
                discover_country = ROOT
            }
			narrow_sea_area = {
                discover_country = ROOT
            }
			shivering_sea_region = {
                discover_country = ROOT
            }
			nefer_sea_region = {
                discover_country = ROOT
            }
			region_qarth = {
                undiscover_country = ROOT
            }
			region_valyria = {
                undiscover_country = ROOT
            }
			ghiscari_sea_region = {
                undiscover_country = ROOT
            }
			essos_central_wastelands = {
                discover_country = ROOT
            }
        }  
    }
}

# If processor dies, designate another
country_event = {
	id = GOT_SYSTEM.5
	title = GOT_SYSTEM.5.title
	desc = GOT_SYSTEM.5.desc
	picture = ASSASSINATION_eventPicture
	
    hidden = yes

    trigger = {
        NOT = {
            any_country = {
                has_country_flag = processor
            }
        }
    }

    mean_time_to_happen = {
        months = 1
    }
    
    option = {
        name = GOT_SYSTEM.5.option.a

        random_country = {
            limit = { ai = yes }
            set_country_flag = processor
        }
    }  
}

# Update Royal House Subjects
country_event = {
	id = GOT_SYSTEM.7
	title = GOT_SYSTEM.7.title
	desc = GOT_SYSTEM.7.desc
	picture = ASSASSINATION_eventPicture
	
    hidden = yes
    
    trigger = {
        has_country_flag = processor
        has_global_flag = update_royal_subjects
    }

    mean_time_to_happen = {
        days = 1
    }
    
    option = {
        name = GOT_SYSTEM.7.option.a

        clr_global_flag = update_royal_subjects
        
        # Release old royal subjects
        every_country = {
            limit = { 
                has_reform = noble_house_reform
                OR = {
                    is_subject_of_type = royal_subject
                    is_subject = no
                }
            }
            
            log = "[This.GetName]"

            # Clear old relations
            every_subject_country = {
                limit = {
                    is_subject_of_type = royal_subject
                }
                grant_independence = yes
            }
        }
        
        country_event = { id = GOT_SYSTEM.8 days = 1 }
    }  
}

country_event = {
	id = GOT_SYSTEM.8
	title = GOT_SYSTEM.8.title
	desc = GOT_SYSTEM.8.desc
	picture = ASSASSINATION_eventPicture
	
    hidden = yes
    is_triggered_only = yes
    
    option = {
        name = GOT_SYSTEM.8.option.a

        clr_global_flag = update_royal_subjects
        
        # Release old royal subjects
        every_country = {
            limit = { 
                has_reform = noble_house_reform
                OR = {
                    is_subject_of_type = royal_subject
                    is_subject = no
                }
            }

            # Add all Noble Houses as subjects to new Royal House
            every_country = {
                limit = { has_reform = royal_house_reform }
                create_subject = {
                    subject_type = royal_subject
                    subject = PREV
                }
            }
        }
    }  
}

